プロの要件定義担当として、開発者が迷わず実装に着手でき、かつプロジェクトのワクワク感が伝わる詳細要件定義書（PRD）を作成しました。

---

# ソフトウェア要件定義書：ギャロップあみだダービー (Gallop Amida Derby)

## 1. プロジェクト概要

### 1.1 目的

従来の「あみだくじ」に競馬のエンタメ性とゲーム性を融合させた、PCブラウザ向けの進化系あみだアプリの開発。多人数が集まる場において、1つの画面を全員で観戦して盛り上がる「パーティ・エンターテインメント・ツール」を目指す。

### 1.2 コンセプト

* **予測不能なドラマ**: 馬の能力と道中のギミックにより、あみだの線を超えた順位変動が発生。
* **戦略的選択**: プレイヤーはコースの特徴（ギミックの偏り）を見て、15頭の個性豊かな馬から1頭を選択。
* **PC最適化**: 横長画面を活かしたダイナミックなスクロールと実況演出。

---

## 2. 技術スタック・動作環境

* **開発言語**: TypeScript
* **ゲームエンジン**: Phaser 3 (推奨)
* **ビルドツール**: Vite
* **開発環境**: Docker, Docker-compose
* **プラットフォーム**: PCブラウザ (Chrome, Edge, Safari最新版)
* **画面解像度**: 1920 \times 1080 (16:9) 固定

---

## 3. ゲームシステム・ロジック

### 3.1 レースの基本挙動

1. **移動**: 全ての馬は左から右へ移動する。速度は \text{baseSpeed} \times \text{speedModifier} で算出。
2. **あみだ分岐**: 「縦線」との接触時、馬の `intelligence` 値に基づいて「曲がる」か「直進」かを判定。
3. **衝突判定**: 馬同士の衝突（追い抜き時の接触）およびギミックへの接触。

### 3.2 5大ギミック詳細

コース上に動的に配置される障害物の仕様。

| ギミック名 | 効果 | 成功/失敗の条件・挙動 |
| --- | --- | --- |
| **🌀 ばね (Spring)** | **強制レーン移動** | 踏んだ瞬間、隣接するレーン（上下ランダム）へ物理的にジャンプ。 |
| **🚧 工事中 (Const.)** | **進路封鎖/迂回** | 衝突で1秒停止。その後、上下の開いているレーンへ強制移動。一部の馬は破壊可能。 |
| **💩 うんこ (Poop)** | **完全停止** | 3秒間のスタン状態。足踏みアニメーションを再生。 |
| **💧 ぬかるみ (Mud)** | **速度低下** | 通過中の移動速度を 0.5倍 に減速。 |
| **🌱 芝生 (Grass)** | **速度上昇** | 通過中の移動速度を 1.5倍 に加速。 |

### 3.3 競走馬クラス定義 (15頭)

各馬は以下のプロパティを持ち、TypeScriptのInterfaceで管理する。

| # | 名前 | 特徴 | 固有ロジック |
| --- | --- | --- | --- |
| 1 | ゴールデンバレット | 最速/虚弱 | 芝生で速度2倍。💩とぬかるみでスタン/減速時間2倍。 |
| 2 | アイアンタフネス | パワー型 | 🚧を破壊。💩のスタン時間を70%カット。 |
| 3 | プロフェッサーP | 知性派 | 分岐を100%曲がる。前方の💩を検知し回避を試みる。 |
| 4 | スプリングホッパー | 跳躍特化 | ばね移動時に2レーン先まで跳び、着地後加速。 |
| 5 | カオス・ジョーカー | 運要素 | ギミック効果を確率で反転（💩で加速など）。 |
| 6 | マッドスライマー | 泥専門 | ぬかるみで減速せず、逆に1.5倍加速。 |
| 7 | グラス・イーター | 芝専門 | 芝生の効果時間がエリア外に出てからも数秒持続。 |
| 8 | ミスター・セーフティ | 防御オーラ | 自身の周囲にいる他馬のギミック被弾を無効化。 |
| 9 | ゴースト・ライダー | 透過体 | 🚧と他馬をすり抜ける。ただし芝生の恩恵も受けない。 |
| 10 | ナイトメア・ハザード | 妨害魔 | ギミック接触時、後方のレーン上に「💩」を設置する。 |

---

## 4. 画面設計とUI

### 4.1 エントリー画面（パドック）

* 15頭の馬のステータスカードを水平に並べる。
* 各レーンのゴール結果（1等、スカ、罰ゲーム等）を入力するテキストエリア。
* 中央に「START」ボタン。

### 4.2 レース画面

* **カメラ追従**: `Lerp` を使用し、先頭の馬が画面左から 1/3 の位置にくるようにスクロール。
* **実況ログ**: 画面右下にリアルタイムで「3番、💩を踏んで脱落！」「1番、芝生でごぼう抜き！」等のテキストを表示。
* **レーン表示**: 各レーンを色分けし、馬のIDを表示。

### 4.3 リザルト画面

* カメラがゴール地点で固定。上位3頭をクローズアップ。
* 「どの馬がどの結果（商品/罰ゲーム）を得たか」を一覧表で表示。

---

## 5. 実装フェーズ（マイルストーン）

1. **Phase 1**: 馬の基本走行とあみだ分岐ロジック（TypeScript）。
2. **Phase 2**: 5大ギミックの衝突判定と効果実装。
3. **Phase 3**: 15頭の固有スキルとキャラクターデータの流し込み。
4. **Phase 4**: カウントダウン、実況、リザルト等の演出追加。

---

### 次のステップとして

この要件定義書をベースに、開発者が最初に使用する**「`Horse`クラスとギミック判定のTypeScriptベースコード」**を作成しましょうか？それとも、**「コースをランダム生成するアルゴリズムの詳細」**を詰めますか？