プロの要件定義担当として、開発者が迷わず実装に着手でき、かつプロジェクトのワクワク感が伝わる詳細要件定義書（PRD）を作成しました。

---

# ソフトウェア要件定義書：ギャロップあみだダービー (Gallop Amida Derby)

## 1. プロジェクト概要

### 1.1 目的

従来の「あみだくじ」に競馬のエンタメ性とゲーム性を融合させた、PCブラウザ向けの進化系あみだアプリの開発。多人数が集まる場において、1つの画面を全員で観戦して盛り上がる「パーティ・エンターテインメント・ツール」を目指す。

### 1.2 コンセプト

* **予測不能なドラマ**: 馬の能力と道中のギミックにより、あみだの線を超えた順位変動が発生。
* **戦略的選択**: プレイヤーはコースの特徴（ギミックの偏り）を見て、15頭の個性豊かな馬から1頭を選択。
* **PC最適化**: 横長画面を活かしたダイナミックなスクロールと実況演出。

---

## 2. 技術スタック・動作環境

* **開発言語**: TypeScript
* **ゲームエンジン**: Phaser 3 (推奨)
* **ビルドツール**: Vite
* **開発環境**: Docker, Docker-compose
* **プラットフォーム**: PCブラウザ (Chrome, Edge, Safari最新版)
* **画面解像度**: 1920 \times 1080 (16:9) 固定

---

## 3. ゲームシステム・ロジック

### 3.1 レースの基本挙動

1. **移動**: 全ての馬は左から右へ移動する。速度は \text{baseSpeed} \times \text{speedModifier} で算出。
2. **あみだ分岐**: 「縦線」との接触時、馬の `intelligence` 値に基づいて「曲がる」か「直進」かを判定。
3. **衝突判定**: 馬同士の衝突（追い抜き時の接触）およびギミックへの接触。

### 3.2 5大ギミック詳細

コース上に動的に配置される障害物の仕様。

| ギミック名 | 効果 | 成功/失敗の条件・挙動 |
| --- | --- | --- |
| **🌀 ばね (Spring)** | **強制レーン移動** | 踏んだ瞬間、隣接するレーン（上下ランダム）へ物理的にジャンプ。 |
| **🚧 工事中 (Const.)** | **進路封鎖/迂回** | 衝突で1秒停止。その後、上下の開いているレーンへ強制移動。一部の馬は破壊可能。 |
| **💩 うんこ (Poop)** | **完全停止** | 3秒間のスタン状態。足踏みアニメーションを再生。 |
| **💧 ぬかるみ (Mud)** | **速度低下** | 通過中の移動速度を 0.5倍 に減速。 |
| **🌱 芝生 (Grass)** | **速度上昇** | 通過中の移動速度を 1.5倍 に加速。 |

### 3.3 競走馬クラス定義 (15頭)

各馬は以下のプロパティを持ち、TypeScriptのInterfaceで管理する。

No,馬名,タイプ,SPD,INT,POW,特殊能力・ギミック特性
01,ゴールデンバレット,スピード特化,1.5,0.8,0.5,芝生超加速: 芝生での加速率が2倍。ただし💩とぬかるみに極端に弱い。
02,アイアンタフネス,パワー型,0.8,0.6,1.8,重装甲: 🚧（工事中）を停止せず破壊。💩のスタン時間を70%カット。
03,プロフェッサーP,知性派,1.0,2.0,0.8,最適解選択: 次に「悪いギミック」がある分岐を100%曲がって回避する。
04,スプリングホッパー,跳躍特化,1.1,1.0,1.0,ハイジャンプ: 🌀（ばね）で2レーン分跳び、着地後2秒間加速する。
05,カオス・ジョーカー,ギャンブル,1.0,1.0,1.0,効果反転: ギミック効果を確率で反転させる（💩で加速、芝生で減速など）。
06,マッドスライマー,泥専門,0.9,0.8,1.5,泥遊び: 💧（ぬかるみ）に入ると不快指数が上がりSpeedが1.5倍になる。
07,グラス・イーター,芝専門,1.0,0.7,1.2,常時ブースト: 🌱（芝生）の効果時間がエリア外に出てからも通常の3倍持続。
08,ミスター・セーフティ,防御支援,0.9,1.2,1.3,安全圏: 自身の周囲にいる他馬も含め、💩とバナナの判定を無効化する。
09,ゴースト・ライダー,透過型,1.1,0.5,1.0,透過: 🚧（工事中）および他馬と衝突しない。ただし芝生の恩恵も受けない。
10,ナイトメア・ハザード,妨害魔,1.2,1.1,0.9,トラップ配置: ギミック接触時、自分の真後ろに「💩」を1つ設置する。
11,ミラクル・ダイス,不確定型,1.0,1.0,1.0,ステータス・シャッフル: 5秒ごとに全ステータスが0.5〜2.5倍の間で変動。
12,ヘヴィ・メタル・ベア,重量級,0.7,0.5,2.5,ヘヴィ・ウェイト: 💧🚧を粉砕。ただし重すぎて🌀（ばね）が反応しない。
13,ドリーム・クリーナー,掃除屋,1.1,1.2,0.8,クリーン・ラン: 前方の💩を食べ、1秒間Speedが1.8倍になる（💩無効）。
14,サイド・スライダー,移動特化,1.0,1.5,1.0,ラテラル・アクセル: あみだの縦線（レーン移動）の速度が3倍。移動中は無敵。
15,アンラッキー・バニー,逆転型,1.2,0.5,0.5,リベンジ・ダッシュ: 💩🚧💧を喰らうたびに、3秒間Speedが蓄積・加算される。

---

## 4. 画面設計とUI

### 4.1 エントリー画面（パドック）

* 15頭の馬のステータスカードを水平に並べる。
* 各レーンのゴール結果（1等、スカ、罰ゲーム等）を入力するテキストエリア。
* 中央に「START」ボタン。

### 4.2 レース画面

* **カメラ追従**: `Lerp` を使用し、先頭の馬が画面左から 1/3 の位置にくるようにスクロール。
* **実況ログ**: 画面右下にリアルタイムで「3番、💩を踏んで脱落！」「1番、芝生でごぼう抜き！」等のテキストを表示。
* **レーン表示**: 各レーンを色分けし、馬のIDを表示。

### 4.3 リザルト画面

* カメラがゴール地点で固定。上位3頭をクローズアップ。
* 「どの馬がどの結果（商品/罰ゲーム）を得たか」を一覧表で表示。

---

## 5. 実装フェーズ（マイルストーン）

1. **Phase 1**: 馬の基本走行とあみだ分岐ロジック（TypeScript）。
2. **Phase 2**: 5大ギミックの衝突判定と効果実装。
3. **Phase 3**: 15頭の固有スキルとキャラクターデータの流し込み。
4. **Phase 4**: カウントダウン、実況、リザルト等の演出追加。

---

### 次のステップとして

この要件定義書をベースに、開発者が最初に使用する**「`Horse`クラスとギミック判定のTypeScriptベースコード」**を作成しましょうか？それとも、**「コースをランダム生成するアルゴリズムの詳細」**を詰めますか？